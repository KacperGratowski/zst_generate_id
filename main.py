from PIL import Image, ImageDraw, ImageFont
import io
import xml.etree.ElementTree as ET
import base64

def birth_from_pesel(pesel):
    rok = int(pesel[0:2])
    miesiac = int(pesel[2:4])
    dzien = int(pesel[4:6])
   
    if miesiac > 20:
        miesiac -= 20
  
    if rok >= 0 and rok <= 19:
        rok += 2000
        
    return f"{dzien:02d}-{miesiac:02d}-{rok}"   
    
def generate(root):
    name = root.find(".//imie").text
    surname = root.find(".//nazwisko").text
    pesel = root.find(".//pesel").text
    nr_leg = root.find(".//nr_leg").text
    exp = root.find(".//data_waz").text
    give = root.find(".//data_wyd").text
    photo_base64 = root.find(".//zdjecieBase64").text
    school = "Zespół Szkół Technicznych \nim. J.J. Śniadeckich w Grudziądzu \nul. Alfonsa Hoffmanna 1-7 \n86-300 Grudziądz"
    principal = "Kazimierz Olszewski"
    full_name = name +" " + surname
    
    birth = birth_from_pesel(pesel)
    zdjecie_decoded = base64.b64decode(photo_base64)
    id_template = Image.open("a.png")
    draw = ImageDraw.Draw(id_template)
    
    font_path = "FrankRuhlLibre-Bold.ttf"
    font_size = 20
    
    school_font= "FrankRuhlLibre-Bold.ttf"
    school_font_size = 16
    
    font = ImageFont.truetype(font_path, font_size)
    s_font = ImageFont.truetype(school_font, school_font_size)
    
    fullname_position = (267, 163)
    pesel_position = (517, 214)
    nr_leg_position = (101,435)
    give_date_position = (267,433)
    birth_position = (267, 214)  
    school_pos = (267, 270)  
    principal_pos = (267,377) 

    draw.text(fullname_position, full_name, fill="black", font=font)
    draw.text(pesel_position, pesel, fill="black", font=font)
    draw.text(nr_leg_position, nr_leg, fill="black", font=font)
    draw.text(give_date_position, give, fill="black", font=font)
    draw.text(birth_position, birth, fill="black", font=font)  
    draw.text(school_pos, school, fill="black", font=s_font)  
    draw.text(principal_pos, principal, fill="black", font=font)  

    image = Image.open(io.BytesIO(zdjecie_decoded))

    image = image.resize((170, 250))
    id_template.paste(image, (64, 167))

    id_template.save('id/' + pesel + '.png')
    print ("wygenerowano dla " + surname)
       
tree = ET.parse("data.xml")
root = tree.getroot()

for i in root[0]:
    generate(i)
print ("KONIEC")
'''                                                                                                            
                                                  ▒▒▒▒▒▒      ▒▒▒▒▒▒                                                        
                                                ▒▒▒▒▒▒▒▒▒▒  ▒▒▒▒░░░░▒▒                                                      
                                              ▒▒▒▒  ▒▒▒▒▒▒▒▒▒▒▒▒▒▒  ▒▒▒▒                                                    
                                              ░░▒▒▒▒▒▒▒▒▒▒██▒▒▒▒▒▒  ▒▒▒▒                                                    
                                              ░░▒▒▒▒▒▒▒▒▒▒██▒▒▒▒▒▒▒▒▒▒▒▒                                                    
                                                ░░▒▒▒▒▒▒▒▒██▒▒▒▒▒▒▒▒░░                                                      
                                                  ░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒                                                          
                                                      ▒▒▒▒██▒▒▒▒                                                            
              ██████                                    ▒▒▒▒▒▒                                                              
              ██████▓▓▓▓░░░░    ░░░░░░░░░░░░░░            ▒▒        ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓  ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓                
              ██████████▓▓▒▒░░                            ░░      ▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▓▓▓▓▒▒▒▒▓▓▓▓▓▓▓▓▒▒▓▓▓▓▒▒▒▒▒▒          
          ░░░░████▓▓████████▓▓  ░░  ░░░░        ░░░░            ▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓        
      ░░░░░░  ████▓▓▓▓██████████        ░░░░      ░░░░          ▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓      
    ░░░░      ████▓▓▓▓▓▓████████▓▓░░░░░░              ░░░░    ▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓    
  ░░          ████▓▓▓▓▓▓██████████░░                    ░░    ▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓    
░░            ████▓▓▓▓▓▓▓▓████░░██░░                    ░░░░▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓  
░░  ░░    ░░░░██████▓▓██▓▓▓▓████        ░░░░                ▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒
░░░░░░  ░░░░░░████████    ▒▒██        ░░            ░░      ▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
░░      ░░  ░░██████░░░░              ░░        ░░░░        ▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
░░    ░░    ░░░░████░░░░                        ░░▓▓        ▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
░░  ░░        ░░░░░░░░        ░░░░▒▒██░░      ▓▓████░░░░      ▓▓▒▒▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
            ░░              ░░░░▓▓▓▓██░░    ░░▓▓▓▓██▓▓░░    ░░  ▓▓▒▒▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▒▒▒▒▒▒▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
░░  ░░    ░░░░  ░░          ░░████▓▓░░    ░░▒▒▒▒▓▓▓▓████░░      ▒▒▓▓▒▒▓▓░░▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▒▒▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
    ░░          ░░        ░░░░██▓▓██░░  ░░░░▒▒▒▒▓▓▓▓████░░      ▓▓▓▓▒▒▓▓░░▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▒▒▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
        ░░                  ▓▓▓▓▓▓▒▒░░▒▒▒▒▒▒▒▒░░░░▒▒▓▓██░░  ░░  ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
  ░░  ░░░░          ░░      ▓▓▓▓▓▓▓▓▓▓▒▒▒▒░░░░  ▓▓░░████░░░░    ████▒▒▒▒▒▒▓▓▓▓▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
░░  ░░  ░░  ░░  ░░░░        ▓▓▓▓▓▓▓▓▓▓██▒▒▒▒░░░░██░░██▓▓        ██▒▒▒▒████████▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
░░          ░░              ▓▓████▓▓▓▓██▒▒▒▒░░░░██░░████      ▒▒▓▓▒▒▓▓██████████▒▒▒▒░░▓▓▒▒▓▓▓▓░░░░▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
░░  ░░          ░░░░          ██████▓▓▓▓██▒▒▒▒▒▒░░░░████      ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▒▒▓▓▓▓░░░░▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓
░░  ░░      ░░░░░░░░          ░░░░▓▓██▓▓▓▓▓▓▓▓▓▓▓▓▓▓████▓▓    ░░  ░░▒▒▒▒▓▓▓▓██▒▒▒▒░░▓▓▒▒▒▒▓▓░░░░░░▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒
    ░░      ░░░░░░░░            ░░░░████████████▓▓████████▒▒        ▒▒▓▓██████▓▓▒▒  ▓▓▒▒▒▒▓▓░░░░▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒
          ░░░░  ░░      ░░          ░░░░░░████████████░░░░░░          ░░            ▓▓▓▓▓▓░░░░▒▒▒▒▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
  ░░░░░░░░      ░░          ░░▒▒▒▒░░▒▒░░░░░░░░░░░░░░░░░░░░░░                          ▓▓▓▓░░░░░░▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
      ░░░░      ░░  ░░░░    ░░▒▒▒▒░░▒▒░░░░░░░░░░░░░░░░░░░░░░                          ▓▓▒▒░░░░░░▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▒▒▒▒
      ░░      ░░      ░░    ░░▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░░░░░░░░░░░                          ▒▒░░░░░░▒▒▓▓▓▓▒▒▒▒▒▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓  ▒▒
░░    ░░  ░░  ░░      ░░    ░░▒▒▒▒▒▒▒▒▒▒░░░░▒▒░░░░░░░░░░░░░░                          ░░░░░░░░▓▓▓▓▓▓▒▒▒▒▓▓▓▓▓▓▒▒▒▒▓▓▓▓▓▓▒▒  
  ░░          ░░░░    ░░      ▒▒▒▒▒▒▒▒▒▒▒▒░░▒▒░░░░░░░░░░░░░░                    ░░░░░░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
  ░░          ░░░░      ░░░░  ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░░░                  ░░░░░░░░░░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
        ░░                    ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░░░              ░░░░░░░░░░░░░░░░░░░░░░░░░░▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓
            ░░      ░░░░        ▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░░░░░░░                        ████████████████      ▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
      ░░░░    ░░            ░░░░▒▒▒▒▒▒▒▒▒▒▒▒▒▒░░                              ████████████████      ▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓
    ░░              ██████████░░██▓▓▒▒▒▒████▒▒                                ████████████▒▒▒▒▒▒    ▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓
                ░░░░  ██▓▓▓▓██▓▓████▒▒▒▒████▒▒                                ████████▒▒▒▒▒▒▒▒▒▒▒▒  ▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
                ▒▒▒▒░░▓▓▓▓▓▓████████▓▓▒▒▒▒▒▒▒▒▒▒                              ████▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒  ░░▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒
              ▓▓████▓▓▓▓▓▓▓▓▓▓▓▓████▓▓▓▓▒▒▒▒▒▒▒▒▒▒                            ████▒▒▒▒████▒▒▒▒▒▒▒▒      ▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒
              ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒                        ▒▒▒▒▒▒▒▒▒▒████▒▒▒▒▒▒▒▒▒▒      ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒
            ▓▓██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒████▒▒                    ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒            ▓▓▓▓▓▓▓▓▓▓▒▒
            ████▓▓▓▓▓▓██▓▓██████▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒████▒▒▒▒                ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒                        
            ████▓▓▓▓▓▓██████████████▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒            ▒▒▒▒████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒                        
            ████▓▓▓▓██████████▓▓████▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒    ▒▒▒▒▒▒▒▒████▒▒▒▒▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒                        
          ████████████████████▓▓████▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒████▒▒▒▒▒▒▒▒▒▒▒▒                        
          ████░░██████▓▓▓▓██████████▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒████▒▒▒▒                        
          ████████████▓▓████▓▓██████▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒████▒▒▒▒                        
          ██▓▓▓▓▓▓▓▓▓▓▓▓████▓▓██▓▓▓▓▓▓▓▓▓▓▓▓▓▓████▒▒████▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒                        
        ▓▓████▓▓▓▓▓▓▓▓▓▓████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒                        
        ██▓▓▓▓▓▓▓▓▓▓▓▓██▓▓████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██▒▒▒▒▒▒▒▒▒▒████▒▒▒▒▒▒████▒▒▒▒▒▒▒▒████▒▒▒▒▒▒▒▒▒▒                          
        ██▓▓██▓▓▓▓▓▓████▓▓██████████▓▓▓▓▓▓▓▓▓▓▓▓████  ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒                          
      ████▓▓▓▓▓▓▓▓▓▓████▓▓▓▓▓▓▓▓██████▓▓▓▓▓▓▓▓▓▓████        ▒▒▒▒▒▒▒▒    ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒                          
      ██▓▓▓▓▓▓▓▓▓▓████  ████▓▓▓▓▓▓████████▓▓▓▓▓▓████                    ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒████▒▒▒▒                          
      ██▓▓▓▓▓▓▓▓▓▓██      ▒▒██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓████                    ▒▒▒▒▒▒████▒▒▒▒▒▒▒▒████▒▒▒▒                          
'''
